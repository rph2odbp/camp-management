{"version":3,"file":"RedirectShopper.js","sources":["../../../../../../src/components/Redirect/components/RedirectShopper/RedirectShopper.tsx"],"sourcesContent":["import { Component, h } from 'preact';\nimport detectInIframeInSameOrigin from '../../../../utils/detectInIframeInSameOrigin';\nimport { ActionHandledReturnObject } from '../../../../types/global-types';\n\ninterface RedirectShopperProps {\n    beforeRedirect: (resolve, reject, url) => Promise<void>;\n    url: string;\n    method: 'GET' | 'POST';\n    data?: any;\n    redirectFromTopWhenInIframe?: boolean;\n    paymentMethodType?: string;\n    onActionHandled?: (rtnObj: ActionHandledReturnObject) => void;\n    onRedirectError?: () => void;\n}\n\nclass RedirectShopper extends Component<RedirectShopperProps> {\n    private postForm;\n    public static defaultProps = {\n        beforeRedirect: resolve => resolve(),\n        onRedirectError: () => {},\n        method: 'GET'\n    };\n\n    componentDidMount() {\n        const doRedirect = () => {\n            // call callback\n            this.props.onActionHandled?.({\n                componentType: this.props.paymentMethodType,\n                actionDescription: 'performing-redirect'\n            });\n\n            // perform redirect\n            if (this.postForm) {\n                this.postForm.submit();\n            } else {\n                if (this.props.redirectFromTopWhenInIframe && detectInIframeInSameOrigin()) {\n                    // if in an iframe and the config prop allows it - try to redirect from the top level window\n                    window.top.location.assign?.(this.props.url);\n                } else {\n                    window.location.assign(this.props.url);\n                }\n            }\n        };\n\n        const dispatchEvent = new Promise(\n            (resolve, reject) =>\n                void this.props.beforeRedirect(resolve, reject, {\n                    url: this.props.url,\n                    method: this.props.method,\n                    ...(this.props.data ? { data: this.props.data } : {})\n                })\n        );\n\n        dispatchEvent.then(doRedirect).catch(() => {\n            this.props.onRedirectError();\n        });\n    }\n\n    render({ url, method, data = {} }) {\n        if (method === 'POST') {\n            return (\n                <form\n                    method=\"post\"\n                    data-testid=\"redirect-shopper-form\"\n                    action={url}\n                    style={{ display: 'none' }}\n                    ref={ref => {\n                        this.postForm = ref;\n                    }}\n                    {...(this.props.redirectFromTopWhenInIframe && detectInIframeInSameOrigin() && { target: '_top' })}\n                >\n                    {Object.keys(data).map(key => (\n                        <input type=\"hidden\" name={key} key={key} value={data[key]} />\n                    ))}\n                </form>\n            );\n        }\n\n        return null;\n    }\n}\n\nexport default RedirectShopper;\n"],"names":["RedirectShopper","Component","componentDidMount","Promise","resolve","reject","this","props","beforeRedirect","_object_spread","url","method","data","then","_this_props_onActionHandled","_this_props","window","onActionHandled","call","componentType","paymentMethodType","actionDescription","postForm","submit","redirectFromTopWhenInIframe","detectInIframeInSameOrigin","top","location","assign","catch","onRedirectError","render","h","form","data-testid","action","style","display","ref","target","Object","keys","map","key","input","type","name","value","super","args","_define_property","defaultProps"],"mappings":"qlBAeA,MAAMA,UAAwBC,EAQ1BC,iBAAAA,GAqB0B,IAAIC,QACtB,CAACC,EAASC,KACDC,KAAKC,MAAMC,eAAeJ,EAASC,EAAQI,EAAA,CAC5CC,IAAKJ,KAAKC,MAAMG,IAChBC,OAAQL,KAAKC,MAAMI,QACfL,KAAKC,MAAMK,KAAO,CAAEA,KAAMN,KAAKC,MAAMK,MAAS,CAAA,MAIhDC,KA7BK,SAEfC,EAAAC,EAWQC,EAAAA,GAXkB,QAA1BF,GAAAC,EAAAT,KAAKC,OAAMU,uBAAX,IAAAH,GAAAA,EAAAI,KAAAH,EAA6B,CACzBI,cAAeb,KAAKC,MAAMa,kBAC1BC,kBAAmB,wBAInBf,KAAKgB,UACLhB,KAAKgB,SAASC,SAEVjB,KAAKC,MAAMiB,6BAA+BC,IAEhB,QAA1BT,GAAAA,EAAAA,OAAOU,IAAIC,UAASC,cAApBZ,IAAAA,GAAAA,OAAAA,EAA6BV,KAAKC,MAAMG,KAExCM,OAAOW,SAASC,OAAOtB,KAAKC,MAAMG,OAcfmB,MAAM,KACjCvB,KAAKC,MAAMuB,mBAEnB,CAEAC,MAAAA,EAAOrB,IAAEA,EAAGC,OAAEA,EAAMC,KAAEA,EAAO,CAAA,IACzB,MAAe,SAAXD,EAEIqB,EAACC,OAAAA,EAAAA,CACGtB,OAAO,OACPuB,cAAY,wBACZC,OAAQzB,EACR0B,MAAO,CAAEC,QAAS,QAClBC,IAAKA,IACDhC,KAAKgB,SAAWgB,IAEfhC,KAAKC,MAAMiB,6BAA+BC,KAAgC,CAAEc,OAAQ,SAExFC,OAAOC,KAAK7B,GAAM8B,IAAIC,GACnBX,EAACY,QAAAA,CAAMC,KAAK,SAASC,KAAMH,EAAKA,IAAKA,EAAKI,MAAOnC,EAAK+B,OAM/D,IACX,mBAhEJK,SAAAC,GACIC,EAAA5C,KAAQgB,gBAAR,IACA4B,EAFElD,EAEYmD,eAAe,CACzB3C,eAAgBJ,GAAWA,IAC3B0B,gBAAiB,OACjBnB,OAAQ"}